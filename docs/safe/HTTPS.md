# HTTPS

**SSL/TLS安全层有两个主要的职责：对发起 HTTP 请求的数据进行加密操作和对接收到 HTTP 的内容进行解密操作。**

HTTPS的迭代：

1. 对称加密
2. 非对称加密
3. 对称加密和非对称加密搭配使用
4. 添加数字证书

## 对称加密

![使用对称加密实现HTTPS](./img/使用对称加密实现HTTPS.png)

具体过程：

1. 浏览器发送它所支持的加密套件列表和一个随机数 client-random，这里的加密套件是指加密的方法，加密套件列表就是指浏览器能支持多少种加密方法列表。
2. 服务器会从加密套件列表中选取一个加密套件，然后还会生成一个随机数 service-random，并将 service-random 和加密套件列表返回给浏览器。
3. 最后浏览器和服务器分别返回确认消息。

## 非对称加密

![非对称加密实现HTTPS](./img/非对称加密实现HTTPS.png)
  
和对称加密只有一个密钥不同，**非对称加密算法有 A、B 两把密钥，如果你用 A 密钥来加密，那么只能使用 B 密钥来解密；反过来，如果你要 B 密钥来加密，那么只能用 A 密钥来解密。**

### 非对称加密的请求流程

- 首先浏览器还是发送加密套件列表给服务器。
- 然后服务器会选择一个加密套件，不过和对称加密不同的是，使用非对称加密时服务器上需要有用于浏览器加密的公钥和服务器解密HTTP 数据的私钥，由于公钥是给浏览器加密使用的，因此服务器会将加密套件和公钥一道发送给浏览器。
- 最后就是浏览器和服务器返回确认消息。

### 缺陷

- 第一个是非对称加密的效率太低。这会严重影响到加解密数据的速度，进而影响到用户打开页面的速度。
- 第二个是无法保证服务器发送给浏览器的数据安全。虽然浏览器端可以使用公钥来加密，但是服务器端只能采用私钥来加密，私钥加密只有公钥能解密，但黑客也是可以获取得到公钥的，这样就不能保证服务器端数据的安全了。

## 对称加密和非对称加密搭配使用

![混合加密实现HTTPS](./img/混合加密实现HTTPS.png)

### 流程

- 首先浏览器向服务器发送对称加密套件列表、非对称加密套件列表和随机数 client-random；

- 服务器保存随机数 client-random，选择对称加密和非对称加密的套件，然后生成随机数 service-random，向浏览器发送选择的加密套件、service-random 和公钥；
- 浏览器保存公钥，并利用 client-random 和 service-random 计算出来 pre-master，然后利用公钥对 pre-master 加密，并向服务器发送加密后的数据；
- 最后服务器拿出自己的私钥，解密出 pre-master 数据，并返回确认消息。

## 添加数字证书

- 权威机构CA（Certificate Authority）
- 数字证书（Digital Certificate)

对于浏览器来说，数字证书有两个作用：

- 一个是通过数字证书向浏览器证明服务器的身份
- 另一个是数字证书里面包含了服务器公钥。

![完整的HTTPS请求流程](./img/完整的HTTPS请求流程.png)
